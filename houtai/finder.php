<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\144\x61\164\141\x2f\x66\x69\156\x64\x65\x72\57"; function __construct() { goto PzAyd; QBext: parent::__construct(); goto pJ4NO; A82Dj: $this->table = "\x66\x69\x6e\x64\145\162"; goto r1bfg; PzAyd: if ($this->table) { goto gz59S; } goto A82Dj; r1bfg: gz59S: goto QBext; pJ4NO: } protected function postAll($pid, $request_data) { goto ioy72; QFbMM: $paths = array(); goto tBbB3; tzAG0: KEFp4: goto o5OsP; tBbB3: if (!$pid) { goto KEFp4; } goto CEotX; P0sXP: $level = array_filter(explode("\x2c", $level)); goto Jbaw1; o5OsP: return array("\x66\151\x6c\x65\x73" => $files, "\x70\x61\x74\150\x73" => $paths); goto co37o; Jbaw1: $paths = $this->db->select($this->table, array("\151\x64", "\x6e\141\155\145"))->where(array("\x69\x64", "\x49\x4e", $level), "\x41\116\104", array("\x74\171\160\145", "\75", "\x66\x6f\154\x64\x65\x72"))->all(); goto tzAG0; ioy72: $files = $this->db->select($this->table)->where($request_data["\x77\150\145\162\145"])->order($request_data["\x6f\x72\144\145\x72"])->all(); goto QFbMM; CEotX: $level = $this->db->select($this->table, "\x6c\145\x76\145\x6c")->where(array("\151\x64", "\x3d", $pid))->get(0); goto P0sXP; co37o: } protected function postAdd($request_data) { goto joaa3; zjWSo: if ($id = $this->db->insert($this->table, $data)->id()) { goto cOj_J; } goto y2kry; PzcLG: cOj_J: goto mwiVB; mj_Yw: $data["\x63\x74\x69\155\145"] = time(); goto sfTVJ; dExHo: $this->db->rollBack(); goto z3TBp; joaa3: $path = $request_data["\160\x61\x74\x68"]; goto wbVNG; YYwpS: $data["\160\141\164\150"] = $path; goto who0d; ClVUi: $foid = $request_data["\x66\x6f\x69\144"]; goto KkVMh; vJD7x: if (mkdir($this->_UTF82GBK("\x2e\x2e\57" . $path), 511, true)) { goto dkcmY; } goto cXqnS; sfTVJ: $data["\145\x78\164"] = end(explode("\56", $name)); goto IiDGj; cXqnS: return $this->error("\345\x88\233\xe5\273\272\346\x96\207\344\xbb\266\xe5\244\xb9\345\xa4\261\350\264\245\357\274\201"); goto lTlN2; YMGOI: pFU09: goto exRvT; Yg37g: rMMrQ: goto YYwpS; tRW3G: if (!(stripos($type, "\151\155\x61\x67\145") !== false && is_file($filename))) { goto rMMrQ; } goto AeIUj; who0d: $data["\x6e\x61\155\145"] = $name; goto NQEki; mwiVB: $level = $this->_getLevel($id); goto oRkRn; HiA_6: $this->db->rollBack(); goto EXcoF; rAY7c: $data["\x73\x69\172\145"] = $request_data["\x73\x69\x7a\145"]; goto mj_Yw; h6Id0: $this->db->commit(); goto tSGJk; z3TBp: return $this->error("\344\270\x8a\344\274\240\xe6\226\x87\xe4\xbb\xb6\40" . $name . "\x20\345\244\xb1\xe8\264\245\357\xbc\x81"); goto hIwft; y2kry: unlink($filename); goto HiA_6; NQEki: $data["\164\x79\160\145"] = $type; goto FJ68t; tSGJk: return $this->success(); goto Fne_U; lTlN2: dkcmY: goto YMGOI; KkVMh: if (is_dir($this->_UTF82GBK("\56\56\x2f" . $path))) { goto pFU09; } goto vJD7x; Fne_U: bKSBr: goto dExHo; FJ68t: $data["\x70\x69\144"] = $foid ? $foid : 0; goto rAY7c; iR8J6: $data["\x77\151\144\x74\x68"] = $imagesize[0]; goto xFbM8; exRvT: $filename = $this->_UTF82GBK("\56\x2e\57" . $path . $name); goto tRW3G; oRkRn: if (!$this->db->update($this->table, array("\154\145\x76\x65\x6c" => $level), array("\151\144", "\75", $id))->is()) { goto bKSBr; } goto h6Id0; Xfc8F: $type = mime_content_type("\56\56\57" . $path . $name); goto ClVUi; IiDGj: $this->db->beginTransaction(); goto zjWSo; EXcoF: return $this->error("\344\270\x8a\344\xbc\xa0\xe6\226\x87\xe4\xbb\266\40" . $name . "\x20\345\244\xb1\xe8\xb4\245\xef\xbc\201"); goto PzcLG; xFbM8: $data["\x68\145\x69\147\150\164"] = $imagesize[1]; goto Yg37g; AeIUj: $imagesize = getimagesize($filename); goto iR8J6; wbVNG: $name = $request_data["\156\141\x6d\x65"]; goto Xfc8F; hIwft: } protected function postMkdir($request_data) { goto qzqar; fMqL_: if (!is_dir($dirname)) { goto q62BA; } goto CjWqK; sdCs8: return $this->success(); goto jHwjc; lvT18: if ($this->db->update($this->table, array("\154\x65\x76\x65\154" => $level), array("\x69\x64", "\x3d", $id))->is()) { goto RzVMl; } goto uuuza; cQZYm: K9TAC: goto QfgjL; LUCGW: $level = $this->_getLevel($id); goto lvT18; KIlLq: rmdir($dirname); goto MlS5i; f4Lbd: if (mkdir($dirname, 493, true)) { goto K9TAC; } goto vBLyi; oDb1w: $folder = $this->db->select($this->table, "\x60\156\141\155\x65\140")->where(array("\x69\x64", "\x49\x4e", $level), "\101\116\x44", array("\x74\x79\160\x65", "\75", "\x66\157\154\x64\x65\162"))->all(); goto V36Lr; AUs2u: goto EoioT; goto fOqGe; t6xAB: vVZ1A: goto GDaVI; aBAkJ: $data["\x70\x69\144"] = $pid; goto LkaA1; Ut2Sy: $level = array_filter(explode("\x2c", $level)); goto oDb1w; LkaA1: $folder_path = ''; goto SUZFe; GIXYi: $this->db->rollBack(); goto unM3Z; tAI2b: $data["\x73\x6f\x72\164\x62\x79"] = 1; goto aJDCy; thi7n: return $this->error("\345\210\x9b\xe5\273\272\346\x96\x87\344\xbb\xb6\345\xa4\271\xe5\244\xb1\350\264\xa5\357\274\201"); goto YZyOG; GDaVI: $dirname = $this->_UTF82GBK("\x2e\x2e\x2f" . $this->root . $folder_path . $name); goto fMqL_; V36Lr: foreach ($folder as $value) { $folder_path .= $value["\x6e\x61\155\x65"] . "\57"; eZgFU: } goto acaQ8; VaP9t: q62BA: goto f4Lbd; OuIXl: $name = $request_data["\x6e\141\x6d\145"]; goto ocPAg; acaQ8: rZ__U: goto t6xAB; QfgjL: $this->db->beginTransaction(); goto kuKlF; uuuza: rmdir($dirname); goto GIXYi; huq8g: $data = array(); goto tVDbZ; paX45: if ($id = $this->db->insert($this->table, $data)->id()) { goto Cn3UD; } goto KIlLq; tVDbZ: $data["\x6e\x61\155\x65"] = $name; goto aBAkJ; v03Ko: DDUK6: goto huq8g; lm2jF: $this->db->commit(); goto sdCs8; vBLyi: return $this->error("\345\x88\x9b\345\xbb\xba\xe6\x96\207\344\273\266\xe5\244\xb9\xe5\xa4\xb1\xe8\264\xa5\xef\274\x81"); goto cQZYm; RXJ32: return $this->error("\xe6\227\240\xe6\225\x88\xe7\x9a\204\345\217\x82\346\x95\xb0\xef\xbc\x81"); goto v03Ko; SUZFe: $level = $this->db->select($this->table, "\140\154\145\166\145\154\x60")->where(array("\151\144", "\x3d", $pid))->get(0); goto mAsdY; ocPAg: if (!($name === null || $name === '')) { goto DDUK6; } goto RXJ32; CjWqK: return $this->error($name . "\x20\xe6\x96\x87\xe4\xbb\266\345\xa4\xb9\xe5\xb7\262\xe5\255\230\xe5\234\250\357\274\201"); goto VaP9t; V5c8V: $data["\x63\164\x69\x6d\x65"] = time(); goto paX45; fOqGe: RzVMl: goto lm2jF; unM3Z: return $this->error("\345\x88\233\xe5\xbb\272\xe6\226\207\xe4\xbb\266\xe5\244\271\xe5\xa4\261\350\264\xa5\357\274\201"); goto AUs2u; MlS5i: $this->db->rollBack(); goto thi7n; aJDCy: $data["\x74\x79\160\x65"] = "\146\157\x6c\144\x65\x72"; goto V5c8V; mAsdY: if (!$level) { goto vVZ1A; } goto Ut2Sy; YZyOG: Cn3UD: goto LUCGW; jHwjc: EoioT: goto Px89C; qzqar: $pid = $request_data["\160\x69\144"]; goto OuIXl; kuKlF: $data["\x70\x61\164\x68"] = $this->root . $folder_path; goto tAI2b; Px89C: } protected function postRename($request_data) { goto Pe3_X; juqRR: return $this->error("\xe6\x96\x87\344\273\266\345\244\xb9\xe9\207\215\xe5\x91\275\345\220\215\xe5\xa4\xb1\xe8\264\245\xef\274\x81"); goto fx04A; xPs7J: $this->db->rollBack(); goto Qkdy8; PROSA: $this->db->rollBack(); goto UUmYZ; XwSc4: HYNAQ: goto g2v1f; ztC0C: $this->db->rollBack(); goto juqRR; jxlDq: tbn4P: goto bKEJ4; rtldv: if ($this->db->update($this->table, array("\x6e\141\x6d\x65" => $name), array("\151\144", "\x3d", $id))->is()) { goto HYNAQ; } goto RqLNG; mnaVq: if ($this->db->update($this->table, array("\156\x61\x6d\x65" => $name), array("\x69\144", "\x3d", $id))->is()) { goto VmoJW; } goto nXl9L; ApByl: PshA3: goto wqcVL; eZmyR: $newname = $this->_UTF82GBK("\56\x2e\57" . $path . $name); goto R3Q5Y; TCE1U: VAMiJ: goto bYJ9O; xcB9I: opvDj: goto t8hOP; VwFuV: VmoJW: goto hKn0O; kESXT: goto RpqmR; goto rAHJJ; rAHJJ: s9xSe: goto mnaVq; fx04A: goto q9y1d; goto bg8uH; AA46E: uP314: goto nNBcr; nNBcr: kNZy8: goto kESXT; wqcVL: $sublist = $this->db->select($this->table, array("\151\x64", "\x6c\x65\166\x65\x6c", "\164\x79\160\145"))->where(array("\x6c\x65\x76\145\154", "\x4c\111\x4b\x45", "\45\54{$id}\54\x25"))->all(); goto XZRcj; I6if1: $oldname = $this->_UTF82GBK("\x2e\x2e\x2f" . $path . $finder["\x6e\x61\x6d\145"]); goto eZmyR; qB9Dq: rename($newname, $oldname); goto ztC0C; Dh1JT: RpqmR: goto mZq4u; Pe3_X: $id = $request_data["\x69\x64"]; goto jc5st; I8Sk5: return $this->error("\xe6\226\207\344\273\xb6\351\207\x8d\xe5\x91\xbd\345\220\215\xe5\244\xb1\350\264\xa5\357\274\201"); goto COlnd; DVRzL: return $this->error("\346\x96\x87\344\xbb\xb6\xe5\244\271\351\x87\215\345\221\xbd\345\220\x8d\345\244\261\350\264\245\xef\xbc\201"); goto sE6QJ; gav1_: return $this->error("\346\x89\276\xe4\xb8\x8d\xe5\210\xb0\351\207\x8d\345\x91\xbd\345\x90\215\347\x9a\x84\xe6\x96\207\344\273\266\57\346\x96\207\344\xbb\266\345\244\271\xef\xbc\201"); goto KhpQr; wtlss: return $this->success(); goto ipUpV; Qkdy8: return $this->error("\346\226\x87\xe4\273\xb6\351\x87\x8d\345\x91\275\xe5\220\x8d\xe5\244\xb1\350\xb4\xa5\xef\xbc\201"); goto vdqHZ; CD7Wy: return $this->error("\xe6\227\240\346\x95\210\347\232\x84\xe5\x8f\x82\346\x95\260\357\xbc\x81"); goto b_6cq; vQmc5: return $this->error("\346\227\240\346\x95\210\xe7\232\x84\350\xb7\xaf\345\xbe\204\xef\274\201"); goto uWcfd; ipUpV: q9y1d: goto jxlDq; LgJcY: $finder = $this->db->select($this->table, array("\160\x61\164\150", "\156\x61\x6d\145", "\x6c\x65\x76\145\x6c"))->where(array("\x69\144", "\x3d", $id))->get(); goto zQmie; zQmie: $path = $finder["\160\141\164\x68"]; goto OsnjP; xyJoo: if (is_dir($oldname)) { goto s9xSe; } goto gav1_; R3Q5Y: $this->db->beginTransaction(); goto qEcdK; XZRcj: foreach ($sublist as $sub) { goto qM4Bi; ETyFQ: $is_path_update = $this->db->update($this->table, array("\160\141\164\x68" => $this->root . $newpath), array("\x69\x64", "\x3d", $sub["\x69\x64"]))->is(); goto DSxFU; yP447: goto tYOZv; goto lVPUQ; lVPUQ: X6jN1: goto wWRp8; qM4Bi: if (!($sub["\154\x65\166\145\154"] == $finder["\154\145\x76\x65\154"])) { goto X6jN1; } goto yP447; nDbDy: foreach ($level as $lid) { goto feQof; qEnQh: ARV1G: goto FCuin; mnQJ1: $newpath .= $level_name != '' ? $level_name . "\57" : ''; goto qEnQh; feQof: $levelobj = $this->db->select($this->table, array("\x6e\141\155\x65", "\x6c\x65\166\x65\x6c"))->where("\x69\x64\x20\x3d\40{$lid}\40\x41\116\x44\x20\164\x79\160\x65\40\75\40\x27\x66\x6f\x6c\x64\x65\x72\x27")->get(); goto iSENP; ERNbb: tAF0H: goto NLyaY; NLyaY: $level_name = $levelobj["\x6e\x61\x6d\145"]; goto mnQJ1; A5fFC: goto ARV1G; goto ERNbb; iSENP: if (!($sub["\x74\171\160\x65"] == "\x66\157\x6c\x64\145\x72" && $sub["\x6c\x65\x76\x65\154"] == $levelobj["\x6c\x65\166\x65\x6c"])) { goto tAF0H; } goto A5fFC; FCuin: } goto aWIBk; DSxFU: if (!($is_path_update === false)) { goto KQox6; } goto vo8od; wWRp8: $newpath = ''; goto XSmSU; vo8od: goto VAMiJ; goto Sat9f; vt4JY: tYOZv: goto BDkRT; aWIBk: dsmu4: goto ETyFQ; XSmSU: $level = array_filter(explode("\54", $sub["\x6c\x65\x76\x65\154"])); goto nDbDy; Sat9f: KQox6: goto vt4JY; BDkRT: } goto TCE1U; bg8uH: ZKJHP: goto cfLrY; qEcdK: if (is_file($oldname)) { goto ek40h; } goto xyJoo; sE6QJ: goto IMdfb; goto VwFuV; COlnd: goto kNZy8; goto XwSc4; bYJ9O: if ($is_path_update !== false) { goto ZKJHP; } goto qB9Dq; wnkaZ: goto tbn4P; goto ApByl; JSGFu: ek40h: goto rtldv; OsnjP: if (!(!$path || stripos($path, $this->root) === false)) { goto NNUnU; } goto vQmc5; UUmYZ: return $this->error($name . "\x20\xe6\x96\x87\344\273\xb6\345\244\xb9\xe5\267\262\xe5\xad\x98\xe5\x9c\xa8\xef\274\201"); goto wnkaZ; t8hOP: $this->db->commit(); goto Eyxzd; KhpQr: goto RpqmR; goto JSGFu; bKEJ4: IMdfb: goto Dh1JT; RqLNG: $this->db->rollBack(); goto I8Sk5; hKn0O: if (rename($oldname, $newname)) { goto PshA3; } goto PROSA; cfLrY: $this->db->commit(); goto wtlss; b_6cq: OJkK5: goto LgJcY; ZVroK: if (!(!$id || $name === null || $name === '')) { goto OJkK5; } goto CD7Wy; g2v1f: if (rename($oldname, $newname)) { goto opvDj; } goto xPs7J; Eyxzd: return $this->success(); goto AA46E; uWcfd: NNUnU: goto I6if1; vdqHZ: goto uP314; goto xcB9I; jc5st: $name = $request_data["\156\141\x6d\145"]; goto ZVroK; nXl9L: $this->db->rollBack(); goto DVRzL; mZq4u: } protected function postIsFile($request_data) { goto nr3OU; N6WFG: if (file_exists($this->_UTF82GBK("\56\56\x2f" . $path . $name))) { goto srIqf; } goto xbjZw; nr3OU: $path = $request_data["\x70\141\x74\x68"]; goto lrw5K; xbjZw: return $this->error($name . "\40\346\x96\207\xe4\273\266\xe4\xb8\215\xe5\255\230\xe5\234\250\357\274\201"); goto i7XOI; i7XOI: goto FONui; goto r5IAG; anNx4: FONui: goto NjfET; r5IAG: srIqf: goto f5HHt; lrw5K: $name = $request_data["\x6e\141\155\x65"]; goto N6WFG; f5HHt: return $this->success($name . "\x20\xe6\x96\207\344\273\xb6\345\xb7\262\345\255\x98\xe5\234\xa8\357\274\201"); goto anNx4; NjfET: } protected function postDelete($request_data) { goto NJFLb; PyO5o: return $this->success(); goto fTLVz; NJFLb: $ids = $request_data["\x69\144"]; goto Vzb22; Vzb22: foreach ($ids as $id) { goto xEK2V; n1nQP: gMXmO: goto m5OnG; hbkTW: wDju0: goto UaVH4; b6M92: if (is_file($filename)) { goto WSwL_; } goto PDxXW; Dy_kN: wYCOP: goto oRWSP; xEK2V: $file = $this->db->select($this->table, array("\160\141\x74\150", "\156\141\155\145"))->where(array("\151\144", "\75", $id))->get(); goto VLofH; wCZAZ: @unlink($filename); goto W2r6f; IZIyE: $this->db->delete($this->table, array("\151\x64", "\75", $id))->is(); goto b5iOm; A0P1L: Acf0d: goto Ocy01; PDxXW: if (is_dir($filename)) { goto wYCOP; } goto wCxd4; uyHNS: R1fZ4: goto n1nQP; oRWSP: if (!$this->db->delete($this->table, array("\x6c\x65\166\145\x6c", "\114\x49\113\x45", "\45\x2c{$id}\x2c\45"))->is()) { goto R1fZ4; } goto DZbD9; MTcVO: goto gMXmO; goto Dy_kN; DZbD9: $this->_rmdir($filename); goto uyHNS; jEAgO: goto loIUU; goto A0P1L; EUIji: goto gMXmO; goto i21Wl; VLofH: if ($file) { goto Acf0d; } goto jEAgO; SwAIs: if (!(!$path || stripos($path, "\x64\x61\164\141\x2f\146\x69\156\x64\145\162\57") === false || $name == null || $name == '')) { goto wDju0; } goto IZIyE; b5iOm: goto loIUU; goto hbkTW; Ocy01: $path = $file["\x70\141\x74\150"]; goto ALWaR; m5OnG: loIUU: goto sQuEE; i21Wl: WSwL_: goto oA_Fx; ALWaR: $name = $file["\156\141\x6d\x65"]; goto SwAIs; W2r6f: CWF1F: goto MTcVO; UaVH4: $filename = $this->_UTF82GBK("\x2e\x2e\57" . $path . $name); goto b6M92; oA_Fx: if (!$this->db->delete($this->table, array("\x69\x64", "\75", $id))->is()) { goto CWF1F; } goto wCZAZ; wCxd4: $this->db->delete($this->table, array("\x6c\x65\166\145\154", "\x4c\111\x4b\x45", "\45\54{$id}\54\45")); goto EUIji; sQuEE: } goto nqmnw; nqmnw: C1Xms: goto PyO5o; fTLVz: } protected function getCurPath($foid) { goto g8qDI; SfGRa: $data = $this->db->select($this->table, array("\151\144", "\156\x61\x6d\145"))->where(array(array("\151\x64", "\111\x4e", $level), "\x41\x4e\x44", array("\164\171\160\145", "\75", "\146\x6f\x6c\144\145\x72")))->all(); goto fTNYD; spFXa: $level = array_filter(explode("\x2c", $level)); goto SfGRa; g8qDI: $level = $this->db->select($this->table, "\x6c\145\166\145\154")->where(array("\151\144", "\x3d", $foid))->get(0); goto spFXa; fTNYD: return $this->success('', $data); goto M0yCZ; M0yCZ: } }
